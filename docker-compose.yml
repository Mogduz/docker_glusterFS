services:
  gluster-solo:
    container_name: ${CONTAINER_NAME:-gluster-solo}
    build:
      context: .
      dockerfile: Dockerfile
    hostname: ${HOSTNAME_GLUSTER:-gluster-solo}
    environment:
      TZ: ${TZ:-UTC}
      UMASK: ${UMASK:-0022}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      VOLNAME: ${VOLNAME:-gv0}
      REPLICA: ${REPLICA:-2}
      TRANSPORT: ${TRANSPORT:-tcp}
      CREATE_VOLUME: ${CREATE_VOLUME:-1}
      ALLOW_FORCE_CREATE: ${ALLOW_FORCE_CREATE:-1}
      VOL_OPTS: ${VOL_OPTS:-performance.client-io-threads=on,cluster.quorum-type=auto}
      AUTH_ALLOW: ${AUTH_ALLOW:-10.0.0.0/8}
      NFS_DISABLE: ${NFS_DISABLE:-1}
    network_mode: host
    privileged: true
    cap_add:
      - SYS_ADMIN
    security_opt:
      - apparmor:unconfined
    devices:
      - /dev/fuse:/dev/fuse
    volumes:
      - ${HOST_BRICK1:?set HOST_BRICK1 in .env}:/bricks/brick1:rw
      - ${HOST_BRICK2:?set HOST_BRICK2 in .env}:/bricks/brick2:rw
      - ./data/glusterd:/var/lib/glusterd
      - ./data/logs:/var/log/glusterfs
